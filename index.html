<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hadith âœ¦ TypeScript forge</title>
    <style>
        /* modern minimal / neubrutalism soft */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #f0f5fe 0%, #e9f0fa 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        .glass-panel {
            max-width: 1050px;
            width: 100%;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 3rem;
            box-shadow: 0 30px 60px rgba(18, 52, 77, 0.12), 0 10px 30px rgba(0, 30, 60, 0.1), inset 0 1px 2px rgba(255,255,255,0.6);
            padding: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        h1 {
            font-size: 2.4rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #103f5c, #1b6d9c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0.5rem;
        }

        .tagline {
            background: #ddeeffcc;
            border-radius: 3rem;
            padding: 0.9rem 2rem;
            margin-bottom: 2.3rem;
            font-weight: 500;
            color: #10405e;
            border: 1px solid #b9d9fc;
            box-shadow: 0 4px 12px rgba(0,60,120,0.08);
            font-size: 1rem;
            backdrop-filter: blur(4px);
        }

        .grid-3 {
            display: flex;
            flex-wrap: wrap;
            gap: 1.2rem;
            margin-bottom: 1.5rem;
        }
        .field {
            flex: 1 1 200px;
        }
        .field label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            color: #1d5980;
            margin-bottom: 0.3rem;
        }
        .field input, .field textarea {
            width: 100%;
            background: white;
            border: 2px solid #c7dfff;
            border-radius: 2rem;
            padding: 0.8rem 1.4rem;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .field input:focus, .field textarea:focus {
            border-color: #1f78b4;
            outline: none;
            box-shadow: 0 8px 18px -12px #1f78b4, 0 0 0 3px rgba(31,120,180,0.15);
        }

        .title-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1.2rem 0 1.8rem;
            background: #e3f0fd70;
            padding: 1.5rem;
            border-radius: 2.5rem;
            border: 1px solid #aad0f9;
        }

        .upload-area {
            background: linear-gradient(120deg, #dcedff, #e8f2ff);
            border-radius: 3rem;
            padding: 2rem 2rem;
            text-align: center;
            border: 2.5px dashed #5588b1;
            margin: 2rem 0 1.8rem;
            transition: background 0.2s;
        }
        .upload-area:hover {
            background: #d0e8ff;
        }
        .upload-btn {
            background: #1f618d;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            padding: 1rem 3rem;
            border-radius: 4rem;
            cursor: pointer;
            box-shadow: 0 12px 28px -12px #1f618d, 0 4px 12px rgba(0,50,90,0.3);
            transition: all 0.2s ease;
            border: 1px solid #4797c9;
            display: inline-block;
        }
        .upload-btn:hover {
            background: #0d4a73;
            transform: scale(1.02);
            box-shadow: 0 18px 32px -12px #0d3b5a;
        }
        .file-status {
            margin-top: 1rem;
            font-weight: 500;
            color: #154f73;
        }

        .generate-btn {
            background: linear-gradient(145deg, #0e3b57, #1a5e88);
            border: none;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            padding: 1.3rem 2rem;
            border-radius: 4rem;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 25px 35px -14px #0a3b57, 0 6px 14px rgba(0,80,130,0.4);
            transition: 0.2s;
            margin: 2.2rem 0 1.5rem;
            letter-spacing: 0.5px;
            border: 1px solid #9ac9f0;
        }
        .generate-btn:hover {
            background: linear-gradient(145deg, #0c3147, #134d73);
            transform: scale(1.01);
            box-shadow: 0 28px 40px -14px #083045;
        }
        .generate-btn:disabled {
            opacity: 0.4;
            pointer-events: none;
            filter: grayscale(0.6);
        }

        .result-modern {
            background: #cdedffc0;
            backdrop-filter: blur(8px);
            border-radius: 3rem;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 1.5rem 0 0.5rem;
            border: 1px solid white;
            box-shadow: 0 8px 22px -10px #2f6590;
        }
        .result-modern span {
            font-weight: 600;
            color: #052136;
            font-size: 1.2rem;
        }
        .download-link {
            background: #103f5c;
            padding: 0.8rem 2.2rem;
            border-radius: 3rem;
            color: white;
            text-decoration: none;
            font-weight: 600;
            letter-spacing: 0.3px;
            border: 1px solid #68b5f0;
            transition: 0.2s;
            box-shadow: 0 8px 18px -10px #022b40;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .download-link:hover {
            background: #052d44;
            transform: translateY(-2px);
        }

        .info-footer {
            background: #cbe5fe;
            border-radius: 2.5rem;
            padding: 1.2rem 2rem;
            font-size: 0.9rem;
            color: #043753;
            border: 1px solid #9cc3ec;
            margin-top: 2.5rem;
            box-shadow: inset 0 1px 5px rgba(255,255,255,0.8);
        }

        hr {
            display: none;
        }
        /* small extras */
        .badge {
            background: #1c6891;
            color: white;
            border-radius: 4rem;
            padding: 0.2rem 1rem;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 0.8rem;
        }
    </style>
</head>
<body>
<div class="glass-panel">
    <h1>
        <span></span> Hadith â†’ TypeScript
        <span class="badge">v2 exact</span>
    </h1>

    <div class="grid-3">
        <div class="field"><label>ID </label> <input type="text" id="prefix" value="h_b1_"></div>
        <div class="field"><label>Book ID</label> <input type="text" id="bookId" value="b_b1"></div>
        <div class="field"><label>Collection ID</label> <input type="text" id="collectionId" value="bukhari"></div>
    </div>
    <div class="grid-3">
        <div class="field"><label>Book number</label> <input type="number" id="bookNumber" value="1" min="1"></div>
        <div class="field"><label>From hadith</label> <input type="number" id="rangeStart" value="1" min="1"></div>
        <div class="field"><label>To hadith</label> <input type="number" id="rangeEnd" value="7" min="1"></div>
    </div>

    <!-- book description & titles (clean row) -->
    <div style="margin: 1.2rem 0 0.5rem;"><label style="font-weight:600;">Book description</label> <input type="text" id="bookDescription" value="The beginning of revelation to the Messenger of Allah." style="width:100%;"></div>

    <div class="title-row">
        <div style="flex:1"><label>English title</label> <input type="text" id="titleEn" value="Revelation"></div>
        <div style="flex:1"><label>Urdu title</label> <input type="text" id="titleUr" value="Ø¨Ø¯Ø¡ Ø§Ù„ÙˆØ­Ù‰"></div>
        <div style="flex:1"><label>Roman Urdu</label> <input type="text" id="titleRo" value="Kitab Bad'ul Wahi"></div>
        <div style="flex:1"><label>Hindi title</label> <input type="text" id="titleHi" value="à¤µà¤¹à¥€"></div>
    </div>

    <!-- upload file -->
    <div class="upload-area">
        <label for="jsonFile" class="upload-btn">Choose JSON </label>
        <input type="file" id="jsonFile" accept="application/json" style="display:none;">
        <div class="file-status" id="fileStatus">No file selected</div>
    </div>

    <button class="generate-btn" id="generateBtn" disabled>GENERATE .TS</button>
    <div id="downloadPanel"></div>

</div>

<script>
(function() {
    // DOM
    const prefixInp = document.getElementById('prefix');
    const bookIdInp = document.getElementById('bookId');
    const collectionIdInp = document.getElementById('collectionId');
    const bookNumberInp = document.getElementById('bookNumber');
    const rangeStartInp = document.getElementById('rangeStart');
    const rangeEndInp = document.getElementById('rangeEnd');
    const bookDescInp = document.getElementById('bookDescription');
    const titleEnInp = document.getElementById('titleEn');
    const titleUrInp = document.getElementById('titleUr');
    const titleRoInp = document.getElementById('titleRo');
    const titleHiInp = document.getElementById('titleHi');
    const jsonFileInp = document.getElementById('jsonFile');
    const fileStatus = document.getElementById('fileStatus');
    const generateBtn = document.getElementById('generateBtn');
    const downloadPanel = document.getElementById('downloadPanel');

    const Language = { ENGLISH: 'en', URDU: 'ur', ROMAN_URDU: 'roman-urdu', HINDI: 'hi', ARABIC: 'ar' };

    const SHARH_FULL = [
        { lang: Language.ARABIC, content: 'coming soon', scholar: 'Ø§Ø¨Ù† Ø­Ø¬Ø± Ø§Ù„Ø¹Ø³Ù‚Ù„Ø§Ù†ÙŠ', author: 'Ibn Hajar al-Asqalani', bookName: 'Fath al-Bari', arabicBookName: 'ÙØªØ­ Ø§Ù„Ø¨Ø§Ø±ÙŠ' },
        { lang: Language.ENGLISH, content: 'coming soon', scholar: 'Ibn Hajar al-Asqalani', author: 'Ibn Hajar al-Asqalani', bookName: 'Fath al-Bari', arabicBookName: 'ÙØªØ­ Ø§Ù„Ø¨Ø§Ø±ÙŠ' },
        { lang: Language.URDU, content: 'coming soon', scholar: 'Ø§Ø¨Ù† Ø­Ø¬Ø± Ø¹Ø³Ù‚Ù„Ø§Ù†ÛŒ', author: 'Ibn Hajar al-Asqalani', bookName: 'Fath al-Bari', arabicBookName: 'ÙØªØ­ Ø§Ù„Ø¨Ø§Ø±ÙŠ' },
        { lang: Language.HINDI, content: 'coming soon', scholar: 'à¤‡à¤¬à¥à¤¨ à¤¹à¤œà¥à¤° à¤…à¤²-à¤…à¤¸à¥à¤•à¤²à¤¾à¤¨à¥€', author: 'Ibn Hajar al-Asqalani', bookName: 'Fath al-Bari', arabicBookName: 'à¤«à¤¼à¤¤ à¤…à¤²-à¤¬à¤¾à¤°à¥€' },
        { lang: Language.ARABIC, content: 'coming soon', scholar: 'Ø§Ø¨Ù† Ø­Ø¬Ø± Ø§Ù„Ø¹Ø³Ù‚Ù„Ø§Ù†ÙŠ', author: 'Ibn Hajar al-Asqalani', bookName: 'Fath al-Bari', arabicBookName: 'ÙØªØ­ Ø§Ù„Ø¨Ø§Ø±ÙŠ' },
        { lang: Language.ENGLISH, content: 'coming soon', scholar: 'Ibn Hajar al-Asqalani', author: 'Ibn Hajar al-Asqalani', bookName: 'Fath al-Bari', arabicBookName: 'ÙØªØ­ Ø§Ù„Ø¨Ø§Ø±ÙŠ' },
        { lang: Language.URDU, content: 'coming soon', scholar: 'Ø§Ø¨Ù† Ø­Ø¬Ø± Ø¹Ø³Ù‚Ù„Ø§Ù†ÛŒ', author: 'Ibn Hajar al-Asqalani', bookName: 'Fath al-Bari', arabicBookName: 'ÙØªØ­ Ø§Ù„Ø¨Ø§Ø±ÙŠ' },
        { lang: Language.HINDI, content: 'coming soon', scholar: 'à¤‡à¤¬à¥à¤¨ à¤¹à¤œà¥à¤° à¤…à¤²-à¤…à¤¸à¥à¤•à¤²à¤¾à¤¨à¥€', author: 'Ibn Hajar al-Asqalani', bookName: 'Fath al-Bari', arabicBookName: 'à¤«à¤¼à¤¤ à¤…à¤²-à¤¬à¤¾à¤°à¥€' }
    ];

    const DEFAULT_OBJECTION = {
        id: 'obj_b1_1',
        objection: {
            [Language.ENGLISH]: "Why did Imam Bukhari start the book of 'Revelation' with a Hadith about 'Intentions'?",
            [Language.ARABIC]: "Ù„Ù…Ø§Ø°Ø§ Ø¨Ø¯Ø£ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ ÙƒØªØ§Ø¨ 'Ø§Ù„ÙˆØ­ÙŠ' Ø¨Ø­Ø¯ÙŠØ« Ø¹Ù† 'Ø§Ù„Ù†ÙŠØ§Øª'ØŸ",
            [Language.URDU]: "Ø§Ù…Ø§Ù… Ø¨Ø®Ø§Ø±ÛŒ Ù†Û’ 'ÙˆØ­ÛŒ' Ú©ÛŒ Ú©ØªØ§Ø¨ Ú©Ø§ Ø¢ØºØ§Ø² 'Ù†ÛŒØª' ÙˆØ§Ù„ÛŒ Ø­Ø¯ÛŒØ« Ø³Û’ Ú©ÛŒÙˆÚº Ú©ÛŒØ§ØŸ",
            [Language.HINDI]: "à¤‡à¤®à¤¾à¤® à¤¬à¥à¤–à¤¾à¤°à¥€ à¤¨à¥‡ 'à¤µà¤¹à¥€' (à¤°à¤¹à¤¸à¥à¤¯à¥‹à¤¦à¥à¤˜à¤¾à¤Ÿà¤¨) à¤•à¥€ à¤•à¤¿à¤¤à¤¾à¤¬ à¤•à¥€ à¤¶à¥à¤°à¥à¤†à¤¤ 'à¤¨à¥€à¤¯à¤¤' à¤µà¤¾à¤²à¥€ à¤¹à¤¦à¥€à¤¸ à¤¸à¥‡ à¤•à¥à¤¯à¥‹à¤‚ à¤•à¥€?"
        },
        answer: {
            [Language.ENGLISH]: "Scholars explain that Revelation is the foundation of Sharia, and Intention is the foundation of Action. Imam Bukhari signals that just as the Prophet (ï·º) received revelation to guide humanity, the seeker of knowledge must rectify their intention to receive that guidance properly.",
            [Language.ARABIC]: "ÙŠÙˆØ¶Ø­ Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡ Ø£Ù† Ø§Ù„ÙˆØ­ÙŠ Ù‡Ùˆ Ø£Ø³Ø§Ø³ Ø§Ù„Ø´Ø±ÙŠØ¹Ø©ØŒ ÙˆØ§Ù„Ù†ÙŠØ© Ù‡ÙŠ Ø£Ø³Ø§Ø³ Ø§Ù„Ø¹Ù…Ù„. ÙŠØ´ÙŠØ± Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ Ø¥Ù„Ù‰ Ø£Ù†Ù‡ ÙƒÙ…Ø§ ØªÙ„Ù‚Ù‰ Ø§Ù„Ù†Ø¨ÙŠ (ï·º) Ø§Ù„ÙˆØ­ÙŠ Ù„Ù‡Ø¯Ø§ÙŠØ© Ø§Ù„Ø¨Ø´Ø±ÙŠØ©ØŒ ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù… ØªØµØ­ÙŠØ­ Ù†ÙŠØªÙ‡ Ù„ØªÙ„Ù‚ÙŠ ØªÙ„Ùƒ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.",
            [Language.URDU]: "Ø¹Ù„Ù…Ø§Ø¡ Ø¨ÛŒØ§Ù† Ú©Ø±ØªÛ’ ÛÛŒÚº Ú©Û ÙˆØ­ÛŒ Ø´Ø±ÛŒØ¹Øª Ú©ÛŒ Ø¨Ù†ÛŒØ§Ø¯ ÛÛ’ Ø§ÙˆØ± Ù†ÛŒØª Ø¹Ù…Ù„ Ú©ÛŒ Ø¨Ù†ÛŒØ§Ø¯ ÛÛ’Û” Ø§Ù…Ø§Ù… Ø¨Ø®Ø§Ø±ÛŒ ÛŒÛ Ø§Ø´Ø§Ø±Û Ø¯ÛŒØªÛ’ ÛÛŒÚº Ú©Û Ø¬Ø³ Ø·Ø±Ø­ Ù†Ø¨ÛŒ Ú©Ø±ÛŒÙ… (ï·º) Ù¾Ø± Ø§Ù†Ø³Ø§Ù†ÛŒØª Ú©ÛŒ Ø±ÛÙ†Ù…Ø§Ø¦ÛŒ Ú©Û’ Ù„ÛŒÛ’ ÙˆØ­ÛŒ Ù†Ø§Ø²Ù„ ÛÙˆØ¦ÛŒØŒ Ø§Ø³ÛŒ Ø·Ø±Ø­ Ø¹Ù„Ù… Ú©Û’ Ù…ØªÙ„Ø§Ø´ÛŒ Ú©Ùˆ Ú†Ø§ÛÛŒÛ’ Ú©Û ÙˆÛ Ø§Ø³ Ø±ÛÙ†Ù…Ø§Ø¦ÛŒ Ú©Ùˆ Ø­Ø§ØµÙ„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø§Ù¾Ù†ÛŒ Ù†ÛŒØª Ø¯Ø±Ø³Øª Ú©Ø±Û’Û”",
            [Language.HINDI]: "à¤µà¤¿à¤¦à¥à¤µà¤¾à¤¨ à¤¬à¤¤à¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤•à¤¿ 'à¤µà¤¹à¥€' à¤¶à¤°à¤¿à¤¯à¤¾ à¤•à¥€ à¤¨à¥€à¤‚à¤µ à¤¹à¥ˆ à¤”à¤° 'à¤¨à¥€à¤¯à¤¤' à¤•à¤°à¥à¤® à¤•à¥€ à¤¨à¥€à¤‚à¤µ à¤¹à¥ˆà¥¤ à¤‡à¤®à¤¾à¤® à¤¬à¥à¤–à¤¾à¤°à¥€ à¤¸à¤‚à¤•à¥‡à¤¤ à¤¦à¥‡à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤•à¤¿ à¤œà¥ˆà¤¸à¥‡ à¤ªà¥ˆà¤—à¤‚à¤¬à¤° (ï·º) à¤•à¥‹ à¤®à¤¾à¤¨à¤µà¤¤à¤¾ à¤•à¤¾ à¤®à¤¾à¤°à¥à¤—à¤¦à¤°à¥à¤¶à¤¨ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ 'à¤µà¤¹à¥€' à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤¹à¥à¤ˆ, à¤µà¥ˆà¤¸à¥‡ à¤¹à¥€ à¤œà¥à¤žà¤¾à¤¨ à¤šà¤¾à¤¹à¤¨à¥‡ à¤µà¤¾à¤²à¥‡ à¤•à¥‹ à¤‰à¤¸ à¤®à¤¾à¤°à¥à¤—à¤¦à¤°à¥à¤¶à¤¨ à¤•à¥‹ à¤ à¥€à¤• à¤¸à¥‡ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤…à¤ªà¤¨à¥€ à¤¨à¥€à¤¯à¤¤ à¤•à¥‹ à¤¶à¥à¤¦à¥à¤§ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤à¥¤"
        },
        references: []
    };

    let rawHadiths = null;

    jsonFileInp.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) { fileStatus.innerText = 'No file selected'; rawHadiths = null; generateBtn.disabled = true; return; }
        fileStatus.innerText = `ðŸ“ ${file.name}`;
        const reader = new FileReader();
        reader.onload = (ev) => {
            try {
                let parsed = JSON.parse(ev.target.result);
                if (!Array.isArray(parsed)) {
                    if (parsed.hadiths && Array.isArray(parsed.hadiths)) parsed = parsed.hadiths;
                    else if (parsed.data && Array.isArray(parsed.data)) parsed = parsed.data;
                    else throw new Error('Top-level array not found');
                }
                rawHadiths = parsed;
                generateBtn.disabled = false;
                fileStatus.innerText += ` â€” ${rawHadiths.length} hadiths loaded`;
            } catch (err) {
                alert('JSON error: ' + err.message);
                rawHadiths = null;
                generateBtn.disabled = true;
            }
        };
        reader.readAsText(file);
    });

    function escapeAll(str) {
        if (typeof str !== 'string') return '';
        return str.replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/'/g, "\\'");
    }

    function cleanNarrator(raw) {
        if (typeof raw !== 'string') return '';
        let s = raw.replace(/^Narrated\s+/i, '');
        s = s.replace(/:/g, '');
        return s.trim();
    }

    generateBtn.addEventListener('click', function() {
        if (!rawHadiths) { alert('Load JSON first'); return; }

        const prefix = prefixInp.value.trim() || 'h_b1_';
        const bookId = bookIdInp.value.trim() || 'b_b1';
        const collectionId = collectionIdInp.value.trim() || 'bukhari';
        const bookNumber = parseInt(bookNumberInp.value, 10);
        const rangeStart = parseInt(rangeStartInp.value, 10);
        const rangeEnd = parseInt(rangeEndInp.value, 10);
        if (isNaN(bookNumber) || bookNumber < 1 || isNaN(rangeStart) || isNaN(rangeEnd) || rangeStart > rangeEnd) {
            alert('Invalid parameters'); return;
        }

        const bookDesc = escapeAll(bookDescInp.value.trim());
        const titleEn = escapeAll(titleEnInp.value.trim());
        const titleUr = escapeAll(titleUrInp.value.trim());
        const titleRo = escapeAll(titleRoInp.value.trim());
        const titleHi = escapeAll(titleHiInp.value.trim());

        const filtered = rawHadiths
            .map(h => ({ ...h, idNum: parseInt(h.idInBook, 10) }))
            .filter(h => !isNaN(h.idNum) && h.idNum >= rangeStart && h.idNum <= rangeEnd)
            .sort((a,b) => a.idNum - b.idNum);

        if (filtered.length === 0) { alert('No hadith in range'); return; }

        const hadithCount = filtered.length;
        const hadithRangeStr = `${rangeStart}-${rangeEnd}`;
        const bookVar = `book${bookNumber}`;
        const hadithArrayVar = `${bookVar}Hadiths`;

        let lines = [];
        lines.push(`import { Language, Book, Hadith } from '../../../../types';`);
        lines.push(``);
        lines.push(`export const ${bookVar}: Book = { `);
        lines.push(`  id: '${bookId}', `);
        lines.push(`  collectionId: '${collectionId}', `);
        lines.push(`  number: ${bookNumber}, `);
        lines.push(`  hadithCount: ${hadithCount}, `);
        lines.push(`  hadithRange: '${hadithRangeStr}', `);
        lines.push(`  description: '${bookDesc}', `);
        lines.push(`  title: { `);
        lines.push(`    [Language.ENGLISH]: '${titleEn}',`);
        lines.push(`    [Language.URDU]: '${titleUr}',`);
        lines.push(`    [Language.ROMAN_URDU]: '${titleRo}',`);
        lines.push(`    [Language.HINDI]: '${titleHi}'`);
        lines.push(`  }`);
        lines.push(`};`);
        lines.push(``);
        lines.push(`export const ${hadithArrayVar}: Hadith[] = [`);

        let previousChapterId = null;
        let isFirstHadith = true;
        let idCounter = 1;

        for (const h of filtered) {
            const hadithNumber = h.idNum.toString();
            const narratorRaw = h.narrator || '';
            const narratorClean = cleanNarrator(narratorRaw);
            const narratorEsc = escapeAll(narratorClean);
            const grade = h.grade || 'Sahih';
            let arabicRaw = h.arabicText || h.text || h.arabic || '';
            if (typeof arabicRaw !== 'string') arabicRaw = String(arabicRaw);
            const arabicEsc = escapeAll(arabicRaw);

            const trans = h.translations || h.translation || {};
            const englishRaw = trans.en || trans.english || trans[Language.ENGLISH] || '';
            const urduRaw = trans.ur || trans.urdu || trans[Language.URDU] || '';
            const romanUrduRaw = trans.roman_urdu || trans[Language.ROMAN_URDU] || 'coming soon...';
            const hindiRaw = trans.hi || trans.hindi || trans[Language.HINDI] || 'coming soon...';

            const englishEsc = escapeAll(englishRaw);
            const urduEsc = escapeAll(urduRaw);
            const romanEsc = escapeAll(romanUrduRaw);
            const hindiEsc = escapeAll(hindiRaw);

            const currentChapterId = h.chapterId || h.chapter_id || h.chapter?.id || '';
            const chapterIdStr = currentChapterId.toString().trim();
            const includeChapter = (chapterIdStr !== '' && chapterIdStr !== previousChapterId);
            previousChapterId = chapterIdStr;

            const autoId = `${prefix}${idCounter++}`;

            lines.push(`  {`);
            lines.push(`    id: '${autoId}',`);
            lines.push(`    hadithNumber: '${hadithNumber}',`);
            lines.push(`    bookId: '${bookId}',`);
            lines.push(`    collectionId: '${collectionId}',`);

            if (includeChapter && chapterIdStr !== '') {
                const ch = h.chapter || {};
                const chId = ch.id || chapterIdStr || '';
                const chArabicTitle = ch.arabicTitle || '';
                const chEnglishTitle = ch.englishTitle || '';
                const chDescEn = ch.description?.[Language.ENGLISH] || ch.description?.en || '';
                const chDescAr = ch.description?.[Language.ARABIC] || ch.description?.ar || '';
                const chDescUr = ch.description?.[Language.URDU] || ch.description?.ur || '';

                lines.push(`    chapter: {`);
                lines.push(`      id: '${escapeAll(chId)}',`);
                lines.push(`      bookId: '${bookId}',`);
                lines.push(`      arabicTitle: '${escapeAll(chArabicTitle)}',`);
                lines.push(`      englishTitle: '${escapeAll(chEnglishTitle)}',`);
                lines.push(`      description: {`);
                lines.push(`        [Language.ENGLISH]: '${escapeAll(chDescEn)}',`);
                lines.push(`        [Language.ARABIC]: '${escapeAll(chDescAr)}',`);
                lines.push(`        [Language.URDU]: '${escapeAll(chDescUr)}'`);
                lines.push(`      }`);
                lines.push(`    },`);
            }

            lines.push(`    narrator: '${narratorEsc}',`);
            lines.push(`    grade: '${grade}',`);
            lines.push(`    arabicText: \`${arabicEsc}\`,`);
            lines.push(`    translations: {`);
            lines.push(`      [Language.ENGLISH]: \`${englishEsc}\`,`);
            lines.push(`      [Language.URDU]: '${urduEsc}',`);
            lines.push(`      [Language.ROMAN_URDU]: '${romanEsc}',`);
            lines.push(`      [Language.HINDI]: '${hindiEsc}'`);
            lines.push(`    },`);

            lines.push(`    sharh: [`);
            for (let i = 0; i < SHARH_FULL.length; i++) {
                const s = SHARH_FULL[i];
                const langKey = Object.keys(Language).find(k => Language[k] === s.lang) || 'ENGLISH';
                lines.push(`      {`);
                lines.push(`        lang: Language.${langKey},`);
                lines.push(`        content: '${s.content}',`);
                lines.push(`        scholar: '${s.scholar}',`);
                lines.push(`        author: '${s.author}',`);
                lines.push(`        bookName: '${s.bookName}',`);
                lines.push(`        arabicBookName: '${s.arabicBookName}'`);
                lines.push(`      }${i < SHARH_FULL.length-1 ? ',' : ''}`);
            }
            lines.push(`    ],`);

            if (isFirstHadith) {
                const objId = `obj_${bookId}_1`;
                lines.push(`    objections: [`);
                lines.push(`      {`);
                lines.push(`        id: '${escapeAll(objId)}',`);
                lines.push(`        objection: {`);
                lines.push(`          [Language.ENGLISH]: '${escapeAll(DEFAULT_OBJECTION.objection[Language.ENGLISH])}',`);
                lines.push(`          [Language.ARABIC]: '${escapeAll(DEFAULT_OBJECTION.objection[Language.ARABIC])}',`);
                lines.push(`          [Language.URDU]: '${escapeAll(DEFAULT_OBJECTION.objection[Language.URDU])}',`);
                lines.push(`          [Language.HINDI]: '${escapeAll(DEFAULT_OBJECTION.objection[Language.HINDI])}'`);
                lines.push(`        },`);
                lines.push(`        answer: {`);
                lines.push(`          [Language.ENGLISH]: '${escapeAll(DEFAULT_OBJECTION.answer[Language.ENGLISH])}',`);
                lines.push(`          [Language.ARABIC]: '${escapeAll(DEFAULT_OBJECTION.answer[Language.ARABIC])}',`);
                lines.push(`          [Language.URDU]: '${escapeAll(DEFAULT_OBJECTION.answer[Language.URDU])}',`);
                lines.push(`          [Language.HINDI]: '${escapeAll(DEFAULT_OBJECTION.answer[Language.HINDI])}'`);
                lines.push(`        },`);
                lines.push(`        references: []`);
                lines.push(`      }`);
                lines.push(`    ],`);
                isFirstHadith = false;
            } else {
                lines.push(`    objections: [],`);
            }

            lines.push(`  },`);
        }
        lines.push(`];`);

        const tsCode = lines.join('\n');
        const fileName = `book${bookNumber}.ts`;
        const blob = new Blob([tsCode], { type: 'text/typescript' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        link.innerHTML = 'â¬‡ï¸ Download ' + fileName;

        downloadPanel.innerHTML = '';
        const resultDiv = document.createElement('div');
        resultDiv.className = 'result-modern';
        resultDiv.innerHTML = '<span>âœ… ' + fileName + ' ready</span>';
        link.className = 'download-link';
        resultDiv.appendChild(link);
        downloadPanel.appendChild(resultDiv);

        link.addEventListener('click', () => setTimeout(() => URL.revokeObjectURL(url), 200));
    });
})();
</script>
</body>
</html>
